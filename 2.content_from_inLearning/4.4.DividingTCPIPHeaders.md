# Dividing into TCP/IP Headers

## Understanding TCP

TCP resides at L4, which stands for transportation layer. It provides connection-oriented transport, begins with a three-way handshake, and data is sequenced and acknowledged. It supports windowing and flow control.

            TCP Header
Source Port          Destination Port
            Sequence Number
            Acknowledgement Number
Offset  Reserved    Flags   Window Size
   Checksum         Urgent Pointer
            Options and Data

## Moving through the TCP handshake and teardown

TCP, which is stand for Transmission Control Protocol, is: 
connection-oriented transport, 
begins with a three-way handshake, 
and ends by terminating the session.

### Three-way handshake

This a method through which the TCP initiate the communication between client and server. It started by client send a SYN packet to the server, which has the aim to synchronize the sequence number between both. If the server accepted, it responds with a SYN-ACK packet to the client, acknowledging the client request of a SYN. The client, then, sends a final acknowledgment, ACK packet, to the server, showing to it that it receives the previous packet.

the process is:

CLIENT -----> SYN packet -----> Server
CLIENT <----- SYN-ACK packet -------- SERVER
CLIENT -----> SYN packet -----> Server

At the end of a handshake, a socket is created and the data can be exchanged between client and server.

### Refusing connection

Periodically, it can occur a refusing connection:

* SYN packet with a RST packet
* No response may mean a firewall
* ICMP destination unreachable packet

When the refusing occur the client must try again with another SYN packet.

### Termination

The connection can be terminated when:

* the connection will be timed out and will be closed
* no password sent, so the connection is RST
* or it occurs an exchange of FIN packet and that indicates a normal termination.

### Normal termination

Client ACK packet to Server
Server FIN-ACK to client
Client FIN-ACK to server
Server ACK to client

## Recognizing User Datagram Protocol

UDP, which is stand for User Datagram Protocol, is a lightweight protocol. It provides connectionless transport layer service, without handshake or connection process, neither ordering or reliability services, and there's no teardown.

### Time sensitive application

UDP must be used by time sensitive application such as
* Domain Name System (DNS), port 53
* Voice over IP (VoIP)
* Routing Information Protocol (RIP)
* Trivial File Transfer Protocol (TFTP)

### Header

            UDP Header
Source Port             Destination Port
  Length                   Checksum
            
### Checksum

It is used for error detection, not correction. The checksum is optional with IPv4, but it is mandatory with IPv6.

## Viewing IPv4

IPv4 is responsible for addressing and routing. It is connectionless, which means that it is best effort. It will try send the packet, but there's no guarantee. And quality service.

### Header

                     IPv4 Header

Version     IHL   Type of Service   Total Length
Identification    Flags             Fragment Offset
Time to Live      Protocol          Header Checksum
               Source Address
               Destination Address
               Options and Data

## Investigating IPv6

IPv6 has new features, such as:

* large address space (it uses a 128 bits, represented as hexadecimal)
* it supports autoconfiguration
* it does not have broadcast, instead it uses multicasting to communicate with multiple hosts.
* streamlined header
* optional extension headers
* connectionless, which means best effort

With IPv6, IGMP (Internet Group Management Protocol) and ARP (Address Resolution Protocol) are not necessary.

The main protocols in network layer (L3) with IPv4 are: IGMP, ICMP, IPv4, ARP;
With IPv6, are ICMPv6, IPv6.

## Comparing Headers

* The internet header length (IHL) does not exist in IPv6
* The fields, which have to do with fragmentation, such as Identification, Flags, Fragment Offset, do not exist in IPv6. IPv6 seeks not to fragment. To fragment, one need to use extension header.
* TTL until exists in IPv6, but now it is called Hop Limit.
* There is not checksum in IPv6

## Grasping ICMP

ICMP is stand for Internet Control Message Protocol and it is an integral part of the internet protocol. It must be implemented by every IP module, and it has no data exchanged. It's used to communicate updates or error messages. And it is used by the ping utility echo request/echo reply.

                  ICMP Messages
Error Reporting                        Query
Type|Message                        Type | Message
3   |Destination unreachable        8/0  |Echo(request/reply)
4   |Source quench                  13/14| Timestamp(req./rep.)
11  |Time exceeded                  18/18| Address mask(req./rep.)
12  |Parameter problem              10/9 |Router solicitation/
                                         | advertisement
5   |Redirection


IP Datagram

IPv4/IPv6 Header 20 bytes | ICMP Message (32 bytes)

ICMP Message (32 bytes)
* 8-bit type
* 8-bit code
* 16-bit checksum

### ICMP Firewall rules

ICMP can be used maliciously because it is used to iam reconnaissance.

The only essential ICMP traffic if type 3.

## ICMPv6 messages

Since IPv6 has no IGMP or ARP, ICMPv6 assumes those two roles.

1. Error messages
2. Informational messages
3. Neighbor discovery messages
4. Neighbor discovery protocol
5. Group membership messages
6. MLD protocol
                                 
                                 