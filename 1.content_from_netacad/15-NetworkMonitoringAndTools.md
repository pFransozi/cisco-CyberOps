# Network monitoring and tools

Since all networks are under attack, it is important for you to understand network monitoring and network monitoring tools to help you defend and protect the network.

## Introduction to network monitoring

### network security topology

**“All networks are targets”** is a common adage used to describe the current landscape of network security. **Therefore, to mitigate threats, all networks must be secured and protected.**

This requires **a defense-in-depth approach**. It requires using proven methods and a security infrastructure consisting of firewalls, intrusion detection systems (IDS), intrusion prevention systems (IPS), **and endpoint security software**. These methods and technologies are used to introduce automated monitoring to the network, create security alerts, or automatically block offensive devices when something goes wrong.

However, for large networks, an extra layer of protection must be added. Devices such as firewalls and IPS operate based on pre-configured rules. They monitor traffic and compare it against the configured rules. If there is a match, the traffic is handled according to the rule. This works relatively seamlessly. However, sometimes legitimate traffic is mistaken for unauthorized traffic. Called false positives, these situations require human eyes to see and evaluate them before they can be validated.

**An important part of the job of the cybersecurity analyst is to review all alerts generated by network devices and determine the validity of the alerts. Was that file that was downloaded by user X really malware? Is that website that was visited by user Y really malicious? Is the printer on the third floor really compromised because it is trying to connect to a server that is out on the internet? These are questions that are commonly asked by security analysts daily. It is their job to determine the correct answers.**

### Network Monitoring Methods

The day-to-day operation of a network consists of common patterns of traffic flow, bandwidth usage, and resource access. Together, these patterns identify normal network behavior. Security analysts must be intimately familiar with normal network behavior because abnormal network behavior typically indicates a problem. To determine normal network behavior, network monitoring must be implemented. Various tools are used to help discover normal network behavior including IDS, packet analyzers, SNMP, NetFlow, and others.

Some of these tools require captured network data. There are two common methods used to capture traffic and send it to network monitoring devices:

* **Network taps, sometimes known as test access points (TAPs)**
* **Traffic mirroring using Switch Port Analyzer (SPAN) or other port mirroring.**

#### Network Taps

A network tap is typically a passive splitting device implemented inline between a device of interest and the network. A tap forwards all traffic, including physical layer errors, to an analysis device while also allowing the traffic to reach its intended destination.
Notice how the tap simultaneously sends both the transmit (TX) data stream from the internal router and the receive (RX) data stream to the internal router on separate, dedicated channels. This ensures that all data arrives at the monitoring device in real time. Therefore, network performance is not affected or degraded by monitoring the connection. Taps are also typically fail-safe, which means if a tap fails or loses power, traffic between the firewall and internal router is not affected. Search the internet for information on NetScout Taps for copper UTP Ethernet, fiber Ethernet, and serial links.

#### Traffic Mirroring and SPAN

Network switches segment the network by design. This limits the amount of traffic that is visible to network monitoring devices. Because capturing data for network monitoring requires all traffic to be captured, special techniques must be employed to bypass the network segmentation imposed by network switches. Port mirroring is one of these techniques. Supported by many enterprise switches, port mirroring enables the switch to copy frames that are received on one or more ports to a Switch Port Analyzer (SPAN) port that is connected to an analysis device.

|SPAN Term|Description|
|Ingress traffic|Traffic that enters the switch.|
|Egress traffic|Traffic that leaves the switch.|
|Source (SPAN) port|Source ports are monitored as traffic entering them is replicated (mirrored) to the destination ports.|
|Destination (SPAN) port|A port that mirrors source ports. Destination SPAN ports often connect to analysis devices such as a packet analyzer or an IDS.|

The switch will forward ingress traffic on F0/1 and egress traffic on F0/2 to the destination SPAN port G0/1 that connects to an IDS.

The association between source ports and a destination port is called a SPAN session. In a single session, one or multiple ports can be monitored. On some Cisco switches, session traffic can be copied to more than one destination port. Alternatively, a source VLAN can be specified in which all ports in the source VLAN become sources of SPAN traffic. Each SPAN session can have ports or VLANs as sources, but not both.

Note: A variation of SPAN called Remote SPAN (RSPAN) enables a network administrator to use the flexibility of VLANs to monitor traffic on remote switches.

#### Network Security Monitoring Tools

Common tools that are used for network security monitoring include:

* Network protocol analyzers such as **Wireshark** and **Tcpdump**
* NetFlow
* Security Information and Event Management Systems (**SIEM**)

It is also common for security analysts to rely on log files and Simple Network Management Protocol (SNMP) for network behavior discovery. Practically all systems generate log files to record and communicate their operations. By closely monitoring log files, a security analyst can gather extremely valuable information. **SNMP allows analysts to request and receive information about the operation of network devices**. It is another good tool for monitoring the behavior of a network. 

### Network Protocol Analyzers

Network protocol analyzers (or "packet sniffer" applications) are programs used to capture traffic. Not only are network protocol analyzers used for security analysis. They are also very useful for network troubleshooting, software and protocol development, and education.

Frames that are captured by Wireshark are saved in a PCAP file. PCAP files contain the frame information, interface information, packet length, time stamps, and even entire binary files that are sent across the network. Wireshark can also open files that contain captured traffic from other software such as the tcpdump utility. Popular among UNIX-like systems such as Linux, tcpdump is a powerful utility with numerous command-line options. The example in the command output displays a sample tcpdump capture of ping packets.

**Note: windump is a Microsoft Windows variant of tcpdump. tshark is a Wireshark command line tool that is similar to tcpdump.**

### NetFlow

NetFlow is a Cisco IOS technology that provides 24x7 statistics on packets that flow through a Cisco router or multilayer switch. NetFlow is the standard for collecting IP operational data in IP networks. NetFlow is now supported on non-Cisco platforms. IP Flow Information Export (IPFIX) is a version of NetFlow that is an IETF standard protocol. NetFlow can be used for network and security monitoring, network planning, and traffic analysis. It provides a complete audit trail of basic information about every IP flow forwarded on a device. This information includes the source and destination device IP information, the time of the communication, and the amount of data transferred. NetFlow does not capture the actual content on the flow. NetFlow functionality is often compared to a telephone bill. The bill identifies the destination number, the time and duration of the call. However, it does not display the content of the telephone conversation.

NetFlow can monitor that application connection by tracking byte and packet counts for that individual application flow. It then pushes the statistics over to an external server called a NetFlow collector. For example, Cisco Stealthwatch collects NetFlow statistics to perform advanced functions including:

* **Flow stitching**: It groups individual entries into flows.
* **Flow deduplication**: It filters duplicate incoming entries from multiple NetFlow clients.
* **NAT stitching**: It simplifies flows with NAT entries.

### SIEM and SOAR

Network security analysts must quickly and accurately assess the significance of any security event and answer the following critical questions:

* Who is associated with this event?
* Does the user have access to other sensitive resources?
* Does this event represent a potential compliance issue?
* Does the user have access to intellectual property or sensitive information?
* Is the user authorized to access that resource?

To help answer these questions, security analysists use:

* Security Information Event Management (SIEM)
* Security orchestration, automation, and response (SOAR)

#### SIEM

**Security Information Event Management (SIEM)** is a technology used in enterprise organizations to provide **real time reporting and long-term analysis of security events**.

Network devices including firewall, IPSs, ESAs, WSAs, routers, switches, servers, and hosts are configured to send log events to the SIEM software. The SIEM software correlates the millions of events using machine learning and special analytics software to identify traffic that should be investigated.

SIEM systems include the following essential functions:

* **Forensic analysis**: The ability to search logs and event records from sources throughout the organization. It provides more complete information for forensic analysis.
* **Correlation**: Examines logs and events from different systems or applications, speeding detection of and reaction to security threats.
* **Aggregation**: Aggregation reduces the volume of event data by consolidating duplicate event records.
* **Reporting**: Reporting presents the correlated and aggregated event data in real-time monitoring and long-term summaries.

SIEM provides details on the source of suspicious activity:

* User information such as username, authentication status, location.
* Device information such as manufacturer, model, OS version, MAC address, network connection method, and location.
* Posture information such as whether the device is compliant with the security policy, has up-to-date antivirus files, and is updated with latest OS patches.

#### SOAR

Security orchestration, automation, and response (SOAR) enhances SIEM. It helps security teams investigate security incidents and adds enhanced data gathering and a number of functionalities that aid in security incident response.

SOAR solutions:

* Provides case management tools that allow cybersecurity personnel to research and investigate incidents, frequently by integrating threat intelligence into the network security platform.
* Use artificial intelligence to detect incidents and aid in incident analysis and response.
* Automate complex incident response procedures and investigations, which are potentially labor intensive tasks that are performed security operations center (SOC ) staff by executing run books. These are playbooks that perform actions such as accessing and analyzing relevant data, taking steps to isolate compromised systems, and researching threats to validate alerts and execute an incident response.
* Offers dashboards and reports to document incident response to improve SOC key performance indicators and can greatly enhance network security for organizations.

SIEM helps sound the alarm for malicious activity. Analysts will have to act on the threat. SOAR helps analysts respond to the threat.

#### SIEM Systems

Several SIEM systems exist. SolarWinds Security Event Manager and Splunk Enterprise Security are two of the more popular proprietary SIEM systems used by SOCs. Search the internet to learn more about these products.

In this course, we will use an open source product called Security Onion that includes the ELK suite for SIEM functionality. ELK is an acronym for three products from Elastic:

* **Elasticsearch**: Document oriented full text search engine
* **Logstash**: Pipeline processing system that connects "inputs" to "outputs" with optional "filters" in between
* **Kibana**: Browser based analytics and search dashboard for Elasticsearch


## Check Your Understanding - Identify the Network Monitoring Tool


1. What allows analysts to request and receive information about the operation of network devices?
   **SNMP allows analysts to request and receive information about the operation of network devices.**

2. What application captures frames that are saved in a file that contains the frame information, interface information, packet length, and time stamps?
   **Wireshark captured frames are saved in a file which contains the frame information, interface information, packet length, and time stamps.**

3. Which tool can be used for network and security monitoring, network planning, and traffic analysis?
   **The NetFlow tool can be used for network and security monitoring, network planning, and traffic analysis.**

4. Which tool is used in enterprise organizations to provide real time reporting and long-term analysis of security events?
   **A SIEM is a tool used in enterprise organizations to provide real time reporting and long-term analysis of security events.**
   
5. Which utility provides numerous command-line options for capturing packets?
   **Tcpdump is a powerful utility with numerous command-line options to capture packets.**

## Network Monitoring and Tools Summary

* **Network Security Topology**: To mitigate threats, all networks must be secured and protected using a defense-in-depth approach. This requires using proven methods and a security infrastructure that consists of firewalls, intrusion detection systems (IDS), intrusion prevention systems (IPS), and endpoint security software. For large networks, an extra layer of protection must be added. A cybersecurity analyst needs to review all alerts that are generated by network devices and validate them. To determine normal network behavior, network monitoring must be implemented. Tools include IDS, packet analyzers, SNMP, NetFlow, and others. Two common methods that are used to capture traffic and send it to network monitoring devices are network taps (TAPs) and traffic mirroring using Switch Port Analyzer (SPAN) or other port mirroring. A network tap is typically a passive splitting device implemented inline between a device of interest and the network. A tap forwards all traffic, including physical layer errors, to an analysis device while also allowing the traffic to reach its intended destination. Network switches segment the network design. This limits the amount of traffic that is visible to network monitoring devices. Because of this, capturing data for network monitoring requires all traffic to bypass the network segmentation imposed by network switches. Port mirroring is a technique that allows this. The following are terms used by the SPAN feature: ingress traffic, egress traffic, source (SPAN) port, and destination (SPAN) port.

* **Introduction to Network Monitoring Tools**: Common tools that are used for network security monitoring include network protocol analyzers (Wireshark and Tcpdump), NetFlow, and Security Information and Event Management Systems (SIEM). It is also common for security analysts to rely on log files and Simple Network Management Protocol (SNMP) for network behavior discovery. Network protocol analyzers (“packet sniffers”) are programs used to capture traffic. They show what is happening on the network, often through a graphic user interface. Analysts can use these applications to see network exchanges down to the packet level. Netflow is a Cisco IOS feature that provides 24x7 statistics on packets that flow through a Cisco router or multilayer switch. It can be used for network and security monitoring, network planning, and traffic analysis. SIEM is a technology that is used to provide real time reporting and long-term analysis of security events. SIEM include forensic analysis, and correlation, aggregation, and reporting functions. Several SEIM systems exist, including SolarWinds Security Manager and Splunk Enterprise Security. Security orchestration, automation, and response (SOAR) systems provide enhancements to SIEM.

## Module 15: Network Monitoring and Tools Quiz

1. What network monitoring tool can be used to copy packets moving through one port, and send those copies to another port for analysis?
   Topic 15.1.0 - The Cisco Switched Port Analyzer (SPAN) feature allows traffic that is coming into or out of a port to be copied to a different port so that it can be collected and analyzed.
   **SPAN**
   
2. What is the purpose of the Cisco NetFlow IOS technology?
   Topic 15.2.0 - NetFlow is a Cisco IOS technology that provides statistics on TCP/IP flows on the network. Some of the capabilities of NetFlow include the following: network and security monitoring, network planning, traffic analysis, identification of network bottlenecks, and IP accounting for billing purposes. 
   **To collect operational data from IP networks**
   
3. Which network technology uses a passive splitting device that forwards all traffic, including Layer 1 errors, to an analysis device?
   Topic 15.1.0 - A network tap is a common technology that is used to capture traffic for monitoring the network. The tap is typically a passive splitting device implemented inline on the network and that forwards all traffic, including physical layer errors, to an analysis device.
   **network tap**
   
4. Which network monitoring tool can provide a complete audit trail of basic information of all IP flows on a Cisco router and forward the data to a device?
   Topic 15.2.0 - NetFlow is a Cisco technology that provides statistics on packets flowing through a Cisco router or multilayer switch.
   **NetFlow**
   
5. What is a monitoring tool used for capturing traffic statistics?
   Topic 15.2.0 - NetFlow is used by some businesses to monitor the network and capture traffic statistics to determine if the network is performing correctly.
   **NetFlow**
   
6. Which capability is provided by the aggregation function in SIEM?
   Topic 15.2.0 - The aggregation function of SIEM reduces the volume of event data by consolidating duplicate event records.
   **reducing the volume of event data by consolidating duplicate event records**
   
7. What is an essential function of SIEM?
   Topic 15.2.0 - SIEM provides real-time reporting and analysis of security events. SIEM provides administrators with details on sources of suspicious activity such as user information, device location, and compliance with security policies. 
   **providing reporting and analysis of security events**
   
8. Which SIEM function is associated with examining the logs and events of multiple systems to reduce the amount of time of detecting and reacting to security events?
   Which SIEM function is associated with examining the logs and events of multiple systems to reduce the amount of time of detecting and reacting to security events?
   **correlation**
   
9.  Which network monitoring capability is provided by using SPAN?
    Topic 15.1.0 - When enabled on a switch, SPAN or port mirroring, copies frames that are sent and received by the switch and forwards them to another port, known as a Switch Port Analyzer port, which has a analysis device attached.
    **traffic exiting and entering a switch is copied to a network monitoring device**

10. Which network tool uses artificial intelligence to detect incidents and aid in incident analysis and response?
    Topic 15.2.0 - SOAR works with SIEMs systems, where SIEM can detect a malicious activity and SOAR helps to respond to the threat. SOAR has many functions and benefits, including these abilities:

    The use of predefined playbooks to enable automatic response to specific threats
    The use of artificial intelligence to detect incidents and aid in incident analysis and response 
    **SOAR**

11. Which network monitoring tool allows an administrator to capture real-time network traffic and analyze the entire contents of packets?
    Topic 15.2.0 - Wireshark captures network traffic in real time. The capture enables the entire contents of the packets to be analyzed including the frame, interface, packet information, and time stamps.
    **WIRESHARK**

12. Which technology is an open source SIEM system?
    Topic 15.2.0 - There are many SIEM systems available to network administrators. The ELK suite is an open source option.
    **ELK**





