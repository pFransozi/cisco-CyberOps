# Cryptography

## Integrity and Authenticity

### Securing Communications

Organizations must provide support to secure the data as it travels across links.

These are the four elements of secure communications:

* **Data Integrity**: Guarantees that the message was not altered. Any changes to data in transit will be detected. Integrity is ensured by implementing either of the Secure Hash Algorithms (SHA-2 or SHA-3). *The MD5 message digest algorithm is still widely in use, however it is inherently insecure and creates vulnerabilities in a network*. The use of MD5 should be avoided.
* **Origin Authentication**: Guarantees that the message is not a forgery and does actually come from whom it states. Many modern networks ensure authentication with algorithms such as hash-based message authentication code (HMAC).
* **Data Confidentiality**: Guarantees that only authorized users can read the message. If the message is intercepted, it cannot be deciphered **within a reasonable amount of time**. Data confidentiality is implemented using symmetric and asymmetric encryption algorithms.
* **Data Non-Repudiation**: Guarantees that the sender cannot repudiate, or refute, the validity of a message sent. Nonrepudiation relies on the fact that only the sender has the unique characteristics or signature for how that message is treated.

### Cryptographic Hash Functions

Hashes are used to verify and ensure data integrity. Hashing is based on a one-way mathematical function that is relatively easy to compute, but significantly harder to reverse. The cryptographic hashing function can also be used to verify authentication.

The cryptographic hash function is applied in many different situations for entity authentication, data integrity, and data authenticity purposes.

### MD5 and SHA

There are four well-known hash functions:

* **MD5 with 128-bit digest**: Developed by Ron Rivest and used in a variety of internet applications, MD5 is a one-way function that produces a 128-bit hashed message. MD5 is considered to be **a legacy algorithm and should be avoided and used only when no better alternatives are available**. It is recommended that SHA-2 or SHA-3 be used instead.
* **SHA-1**: Developed by the U.S. National Security Agency (NSA) in 1995. It is very similar to the MD5 hash functions. Several versions exist. SHA-1 creates a 160-bit hashed message and is slightly slower than MD5. **SHA-1 has known flaws and is a legacy algorithm**.
* **SHA-2**: Developed by the NSA. It includes SHA-224 (224 bit), SHA-256 (256 bit), SHA-384 (384 bit), and SHA-512 (512 bit). If you are using SHA-2, then the SHA-256, SHA-384, and SHA-512 algorithms should be used whenever possible.
* **SHA-3**: SHA-3 is the newest hashing algorithm and was introduced by NIST as an alternative and eventual replacement for the SHA-2 family of hashing algorithms. SHA-3 includes SHA3-224 (224 bit), SHA3-256 (256 bit), SHA3-384 (384 bit), and SHA3-512 (512 bit). The SHA-3 family are next-generation algorithms and should be used whenever possible.

**While hashing can be used to detect accidental changes, it cannot be used to guard against deliberate changes that are made by a threat actor. Therefore, hashing is vulnerable to man-in-the-middle attacks and does not provide security to transmitted data. To provide integrity and origin authentication, something more is required.**

**Note: Hashing algorithms only protect against accidental changes and does not protect the data from changes deliberately made by a threat actor.**

### Origin Authentication

**To add origin authentication and integrity assurance**, use a keyed-hash message authentication code (HMAC). HMAC uses an additional secret key as input to the hash function.

**Note: Other Message Authentication Code (MAC) methods are also used. However, HMAC is used in many systems including SSL, IPsec, and SSH.**

HMAC Hashing algorithm: it's combined a cryptographic hash function with a secret key. Only the sender and the receiver know the secret key, and the output of the hash function now depends on the input data and the secret key. Only parties who have access to that secret key can compute the digest of an HMAC function. This defeats man-in-the-middle attacks and provides authentication of the data origin.

The data and the secret key are inputted in the HMAC hash function. The result is a authenticated fingerprint. It is authenticated because the secret key change the result. In a scenario where the same data is encrypted with different secret keys, the result will be different.

### Data Confidentiality

There are two classes of encryption **used to provide data confidentiality**; asymmetric and symmetric. These two classes differ in how they use keys.

**Symmetric encryption algorithms** such as Data Encryption Standard (DES), 3DES, and Advanced Encryption Standard (AES) **are based on the premise that each communicating party knows the pre-shared key**. **Data confidentiality** can also be ensured **using asymmetric algorithms**, including Rivest, Shamir, and Adleman (RSA) and the public key infrastructure (PKI).

**Note: DES is a legacy algorithm and should not be used. 3DES should be avoided if possible.**

Symmetric: use the same key to encrypt and decrypt data; key lengths are short (40 bits - 256 bits); faster that asymmetric encryption; commonly used for encrypting bulk data such as in VPN traffic.

Asymmetric encryption: uses different keys to encrypt and decrypt data; key lengths are long (512 bits - 4096 bits); computationally taxing therefore slower than symmetric encryption; commonly used for quick data transactions such as HTTPs when accessing your bank data.

### Symmetric encryption

Symmetric algorithms use the same **pre-shared key to encrypt and decrypt data**. A pre-shared key, also called a secret key, **is known by the sender and receiver before** any encrypted communications can take place.

**Symmetric encryption algorithms are commonly used with VPN traffic**. This is because symmetric algorithms use less CPU resources than asymmetric encryption algorithms. This allows the encryption and decryption of data to be fast when using a VPN. When using symmetric encryption algorithms, like any other type of encryption, the longer the key, the longer it will take for someone to discover the key. Most encryption keys are between 112 and 256 bits. To ensure that the encryption is safe, a minimum key length of 128 bits should be used. Use a longer key for more secure communications.

**Symmetric encryption algorithms are sometimes classified as either a block cipher or a stream cipher**.

**Block ciphers** transform a fixed-length block of plaintext into a common block of ciphertext of 64 or 128 bits. Common block ciphers include DES with a 64-bit block size and AES with a 128-bit block size.

**Stream ciphers** encrypt plaintext one byte or one bit at a time. Stream ciphers are basically a block cipher with a block size of one byte or bit. **Stream ciphers are typically faster than block ciphers because data is continuously encrypted**. Examples of stream ciphers include RC4 and A5 which is used to encrypt GSM cell phone communications.

**Well-known symmetric encryption algorithms are described in the table.**

|  Symmetric Encryption Algorithms  |    Description    |
|-----------------------------------|-------------------|
|Data Encryption Standard (DES)     | This is a legacy symmetric encryption algorithm. It uses a short key length that makes it insecure for most current uses|
|3DES (Triple DES)                  | The is the replacement for DES and repeats the DES algorithm process three times. It should be avoided if possible as it is scheduled to be retired in 2023. If implemented, use very short key lifetimes|
|Advanced Encryption Standard (AES) | AES is a popular and recommended symmetric encryption algorithm. It offers combinations of 128-, 192-, or 256-bit keys to encrypt 128, 192, or 256 bit-long data blocks|
| Software-Optimized Encryption Algorithm (SEAL) | SEAL is a faster alternative symmetric encryption algorithm to AES. SEAL is a stream cypher that uses a 160-bit encryption key and has a lower impact on the CPU compared to other software-based algorithms|
| Rivest ciphers (RC) series algorithms|This algorithm was developed by Ron Rivest. Several variations have been developed, but RC4 was the most prevalent in use. RC4 is a stream cipher that was used to secure web traffic. It has been found to have multiple vulnerabilities which have made it insecure. RC4 should not be used|

### Asymmetric Encryption

Asymmetric algorithms, also called public-key algorithms, are designed so that the key that is used for encryption is different from the key that is used for decryption. The decryption key cannot, in any reasonable amount of time, be calculated from the encryption key and vice versa.

Asymmetric algorithms use a public key and a private key. **Both keys are capable of the encryption process, but the complementary paired key is required for decryption**. **The process is also reversible**. **Data that is encrypted with the public key requires the private key to decrypt. Asymmetric algorithms achieve confidentiality and authenticity by using this process**.

Because neither party has a shared secret, very long key lengths must be used. Asymmetric encryption can use key lengths between 512 to 4,096 bits. Key lengths greater than or equal to 2,048 bits can be trusted, while key lengths of 1,024 or shorter are considered insufficient.

Examples of protocols that use asymmetric key algorithms include:

* **Internet Key Exchange (IKE)**: This is a fundamental component of IPsec VPNs.
* **Secure Socket Layer (SSL)**: This is now implemented as IETF standard **Transport Layer Security (TLS)**.
* **Secure Shell (SSH)**: This protocol provides a secure remote access connection to network devices.
* **Pretty Good Privacy (PGP)**: This computer program provides cryptographic privacy and authentication. It is often used to increase the security of email communications. **Asymmetric algorithms are substantially slower than symmetric algorithms**. Their design is based on computational problems, such as factoring extremely large numbers or computing discrete logarithms of extremely large numbers. Because they are slow, asymmetric algorithms are typically used in low-volume cryptographic mechanisms, such as digital signatures and key exchange. However, the key management of asymmetric algorithms tends to be simpler than symmetric algorithms, because usually one of the two encryption or decryption keys can be made public.

|Asymmetric Encryption Algorithm|Key Length|Description|
|-------------------------------|----------|-----------|
|Diffie-Hellman (DH)            |512, 1024, 2048, 3072, 4096|The Diffie-Hellman algorithm allows two parties to agree on a key that they can use to encrypt messages they want to send to each other. The security of this algorithm depends on the assumption that it is easy to raise a number to a certain power, but difficult to compute which power was used given the number and the outcome|
|Digital Signature Standard (DSS) and Digital Signature Algorithm (DSA)| 512 - 1024|DSS specifies DSA as the algorithm for digital signatures. DSA is a public key algorithm based on the ElGamal signature scheme. Signature creation speed is similar to RSA, but is 10 to 40 times slower for verification|
|Rivest, Shamir, and Adleman encryption algorithms (RSA)|512 to 2048|RSA is for public-key cryptography that is based on the current difficulty of factoring very large numbers. It is the first algorithm known to be suitable for signing, as well as encryption. It is widely used in electronic commerce protocols and is believed to be secure given sufficiently long keys and the use of up-to-date implementations|
|EIGamal|512 - 1024|An asymmetric key encryption algorithm for public-key cryptography which is based on the Diffie-Hellman key agreement. A disadvantage of the ElGamal system is that the encrypted message becomes very big, about twice the size of the original message and for this reason it is only used for small messages such as secret keys|
|Elliptic curve techniques|224 or higher|Elliptic curve cryptography can be used to adapt many cryptographic algorithms, such as Diffie-Hellman or ElGamal. The main advantage of elliptic curve cryptography is that the keys can be much smaller|

### Asymmetric Encryption - Confidentiality

Asymmetric algorithms are used to provide confidentiality without pre-sharing a password. The confidentiality objective of **asymmetric algorithms is initiated when the encryption process is started with the public key**.

The process can be summarized using the formula: Public Key (Encrypt) + Private Key (Decrypt) = Confidentiality. When the public key is used to encrypt the data, the private key must be used to decrypt the data. Only one host has the private key; therefore, confidentiality is achieved. If the private key is compromised, another key pair must be generated to replace the compromised key.

### Asymmetric Encryption - Authentication

The authentication objective of asymmetric algorithms is initiated when the encryption process is started with the private key. The process can be summarized using the formula: Private Key (Encrypt) + Public Key (Decrypt) = Authentication. When the private key is used to encrypt the data, the corresponding public key must be used to decrypt the data. Because only one host has the private key, only that host could have encrypted the message, providing authentication of the sender. Typically, no attempt is made to preserve the secrecy of the public key, so any number of hosts can decrypt the message. When a host successfully decrypts a message using a public key, it is trusted that the private key encrypted the message, which verifies who the sender is. This is a form of authentication.

### Asymmetric Encryption - Integrity

Combining the two asymmetric encryption processes provides message confidentiality, authentication, and integrity. A message will be ciphered using Bob’s public key and a ciphered hash will be encrypted using Alice’s private key to provide confidentiality, authenticity, and integrity.

### Diffie-Hellman

Diffie-Hellman (DH) **is an asymmetric mathematical algorithm that allows two computers to generate an identical shared secret without having communicated before**. **The new shared key is never actually exchanged between the sender and receiver**. However, because both parties know it, the key can be used by an encryption algorithm to encrypt traffic between the two systems. Here are two examples of instances when DH is commonly used: Data is exchanged using an IPsec VPN; SSH data is exchanged.

The security of DH is based on the fact that it uses very large numbers in its calculations. For example, a DH 1024-bit number is roughly equal to a decimal number of 309 digits. Considering that a billion is 10 decimal digits (1,000,000,000), one can easily imagine the complexity of working with not one, but multiple 309-digit decimal numbers.

Diffie-Hellman uses different DH groups to determine the strength of the key that is used in the key agreement process. The higher group numbers are more secure, but require additional time to compute the key. The following identifies the DH groups supported by Cisco IOS Software and their associated prime number value:

* DH Group 1: 768 bits
* DH Group 2: 1024 bits
* DH Group 5: 1536 bits
* DH Group 14: 2048 bits
* DH Group 15: 3072 bits
* DH Group 16: 4096 bits

Note: A DH key agreement can also be based on elliptic curve cryptography. DH groups 19, 20, and 24, which are based on elliptic curve cryptography, are also supported by Cisco IOS Software.

Unfortunately, asymmetric key systems are extremely slow for any sort of bulk encryption. This is why it is common to encrypt the bulk of the traffic using a symmetric algorithm, such as 3DES or AES and use the DH algorithm to create keys that will be used by the encryption algorithm.

### Check Your Understanding - Classify the Encryption Algorithms

1. True or False? In asymmetric encryption, encryption and decryption use the same key. False
2. What is an example of a symmetric encryption algorithm? AES
3. Which algorithm provides asymmetric encryption? DH
4. Which hash function is the most secure? SHA-3

## Publick Key Cryptography

### Using Digital Signatures

Digital signatures are a mathematical technique used to provide **authenticity**, **integrity**, and **nonrepudiation**. Digital signatures have specific properties that enable entity authentication and data integrity. In addition, digital signatures provide nonrepudiation of the transaction. In other words, the digital signature serves as legal proof that the data exchange did take place. Digital signatures use asymmetric cryptography.

Four properties:

1. authentic: the signature cannot be forged and provides proof that the signer, and no one else, signed the document
2. unalterrable: after a doc is signed, it cannot be altered.
3. not reusable: the doc signature cannot be transferred to another document.
4. non-repudiated: the signed document is considered to be the same as a physical document. The signature is proof that the document has been signed by the actual person.

Digital signatures are used in two situations:

1. code signing: in this case it is used for data integrity and authentication purposes, verifying the integrity of executable files downloaded from a vendor website, and authenticating and verifying the identity of the site that if the source of the files.
2. digital certificates: it is used to authenticate the identity of system with a vendor website and establish an excrypted connection to exchange confidential data.

Three Digital Signature Standard (DSS) algorithms that are used for generating and verifying digital signatures.

1. DSA (digital signature algorithm): dsa is the original standard for generating public and private key pairs, and for generating and verifying digital signatures
2. RSA (rivest-shamir adelman algorithm): rsa is an asymmetric algorithm that is commonly used for generating and verifying digital sinatures.
3. ECDSA (ellipict curve digital sinature algorithm): ecdsa is a newer variant of dsa and provide digital signature authentication and non-repudiation with the added benefits of computational efficiency, small sinagure sizes, and minimal bandwidth.

### Digital Signatures for Code Signing

Digital signatures are commonly used to provide assurance of the authenticity and integrity of software code. Executable files are wrapped in a digitally signed envelope, which allows the end user to verify the signature before installing the software.

The main assurances provide by the digitally signing code are:

1. The code is authentic and is actually sourced by the publisher.
2. The code has not been modified since it left the software publisher.
3. The publisher undeniably published the code. This provides nonrepudiation of the act of publishing.

Digital signatures serve as verification that the code has not been tampered with by threat actors and malicious code has not been inserted into the file by a third party.

### Digital Signatures for Digital Certificates

A digital certificate is used to authenticate and verify that a user who is sending a message is who they claim to be. Digital certificates can also be used to provide confidentiality for the receiver with the means to encrypt a reply. Digital signatures are used to verify that an artifact, such as a file or message, is sent from the verified individual. In other words, a certificate verifies identity, a signature verifies that something comes from that identity.

Image the following scenario:

1. Bob is confirming an order with Alice;
2. Alice is ordering from Bob's website.
3. Alice has connected with Bob's website, and after the certificate has been verified, the Bob's certificate is stored on Alice's website. The certificate contains Bob's public key. The publick key is used to verify the Bob's digital signature.
4. Bob confirms the order and his compute creates a hash of the confirmation. The computer encrypts the hash with Bob's private key. The encrypted hash, which is the digital signature, is appended to the document. The order confirmation is then sent to Alice over the internet.
5. Alice's receiving device accepts the order confirmation with the digital signature and obtains Bob's public key.
6. Alice's computer then decrypts the signature using Bob's public key. This step reveals the assumed hash value of the sending device.
7. Alice's computer creates a hash of the received document, without its signature, and compares this hash to the decrypted signature hash. If the hashes match, the document is authentic. This means the confirmation was sent by Bob and that it has not changed since it was signed.

## Authorities and the PKI Trust System

### Public Key Management

When establishing an asymmetric connection between two hosts, the hosts will exchange their public key information. An SSL certificate is a digital certificate that confirms the identity of a website domain. To implement SSL on your website, you purchase an SSL certificate for your domain from an SSL Certificate provider. The trusted third party does an in-depth investigation prior to the issuance of credentials. After this in-depth investigation, the third-party issues credentials (i.e. digital certificate) that are difficult to forge. From that point forward, all individuals who trust the third party simply accept the credentials that the third-party issues. When computers attempt to connect to a web site over HTTPS, the web browser checks the website’s security certificate and verifies that it is valid and originated with a reliable CA. This validates that the website identify is true. The certificate is saved locally by the web browser and is then used in subsequent transactions. The website’s public key is included in the certificate and is used to verify future communications between the website and the client.

The Public Key Infrastructure (PKI) consists of specifications, systems, and tools that are used to create, manage, distribute, use, store, and revoke digital certificates. The certificate authority (CA) is an organization that creates digital certificates by tying a public key to a confirmed identify, such as a website or individual. The PKI is an intricate system that is designed to safeguard digital identities from hacking by even the most sophisticated threat actors or nation states.

Some examples of Certificate Authorities are IdenTrust, DigiCert, Sectigo, GlobalSign, and GoDaddy. These CAs charge for their services. Let’s Encrypt is a non-profit CA that offers certificates free of charge.

### The Public Key Infrastructure

PKI is needed to support large-scale distribution and identification of public encryption keys. The PKI framework facilitates a highly scalable trust relationship.

1. PKI certificates contain an entity's or individual's public key, its purpose, the certificate authority (CA) that validated and issued the certificate, the date range during  which the certificate is valid, and the algorithm used to create the signature.
2. The certificate store resides on a local computer and stores issued certificates and private keys
3. the PKI certificate of authority (CA) is a trusted third party that issues PKI certificates to entities and individuals after verifying their identity. It signs these certicates using its private key.
4. the certificate database stores all certificates approved by CA.

Let see an example:

1. Bob has received his digital certificate from the CA. This certificate is used whenever Bob communicates with other parties.
2. Bob communicates with Alice.
3. When Alice receives Bob's digital certificate, she communicates with the trusted CA to validate Bob's identity.

Note: Not all PKI certificates are directly received from a CA. A registration authority (RA) is a subordinate CA and is certified by a root CA to issue certificates for specific uses.

### The PKI Authorities System

Many vendors provide CA servers as a managed service or as an end-user product or organizations may also implement private PKIs using Microsoft Server or Open SSL.

The table provides a description of the classes. The class number is determined by how rigorous the procedure was that verified the identity of the holder when the certificate was issued. The higher the class number, the more trusted the certificate. Therefore, a class 5 certificate is trusted much more than a lower-class certificate.

|Class|Description|
|-----|-----------|
|0|Used for testing in situations in which no checks have been performed|
|1|Used by individuals who require verification of email|
|2|Used by organizations for which proof of identity is required|
|3|Used for servers and software signing. Independent verification and checking of identity and authority is done by the certificate authority|
|4|Used for online business transactions between companies|
|5|Used for private organizations or government security|

### The PKI Trust System

PKIs can form different topologies of trust. 

The simplest is the **single-root PKI topology**. A single CA, called the root CA, issues all the certificates to the end users, which are usually within the same organization. The benefit to this approach is its simplicity. However, it is difficult to scale to a large environment because it requires a strictly centralized administration, which creates a single point of failure.

On larger networks, PKI CAs may be linked using two basic architectures:

**Cross-certified CA topologies**: this is a peer-to-peer model in which individual CAs establish trust relationships with other CAs by cross-certifying CA certificates. Users in either CA domain are also assured that they can trust each other. This provides redundancy and eliminates the single-point of failure.

**Hierarchical CA topologies**: the highest-level CA is called the root CA. It can issue certificates to end users and to a subordinate CA. The sub-CAs could be created to support various business units, domains, or communities of trust. The root CA maintains the established “community of trust” by ensuring that each entity in the hierarchy conforms to a minimum set of practices. The benefits of this topology include increased scalability and manageability. This topology works well in most large organizations. However, it can be difficult to determine the chain of the signing process.

A hierarchical and cross-certification topology can be combined to create a hybrid infrastructure. An example would be when two hierarchical communities want to cross-certify each other in order for members of each community to trust each other.

### Interoperability of Different PKI Vendors

Interoperability between a PKI and its supporting services, such as Lightweight Directory Access Protocol (LDAP) and X.500 directories, is a concern because many CA vendors have proposed and implemented proprietary solutions instead of waiting for standards to develop.

Note: LDAP and X.500 are protocols that are used to query a directory service, such as Microsoft Active Directory, to verify a username and password.

To address this interoperability concern, the IETF published the Internet X.509 Public Key Infrastructure Certificate Policy and Certification Practices Framework (RFC 2527). The X.509 version 3 (X.509 v3) standard defines the format of a digital certificate.

Refer to the figure for more information about X.509 v3 applications. As shown in the figure, the X.509 format is already extensively used in the infrastructure of the internet.

SSL: secure web servers use X509.v3 for website authentication in the SSL and TLS protocols, while web browsers use X.509v3 to implement HTTPS client certificates. SSL is the most widely used certificate-based authentication.
IPSec: IPsec VPNs use X.509 certificates when RSA-based authentication is used for internet key exchange (IKE)
S/MIME: user mail agents that support mail protection with the secure/multipurpose internet mail extensions (S/MIME) protocol use X.509 certificates.
EAP-TLS: cisco switches can use certificates to authenticate end devices that connect to LAN ports using 802.1x between the adjacent devices. The authentication can be proxied to a central ACS via the Extensible Authentication Protocol with TLS.

### Certificate Enrollment, Authentication, and Revocation

**The first step in the CA authentication procedure is to securely obtain a copy of the CA’s public key**. All systems that leverage the PKI must have the **CA’s public key**, which is called the self-signed certificate. The CA public key verifies all the certificates issued by the CA and is vital for the proper operation of the PKI.

Note: Only a root CA can issue a self-signed certificate that is recognized or verified by other CAs within the PKI.

**For many systems such as web browsers, the distribution of CA certificates is handled automatically**. The web browser comes pre-installed with **a set of public CA root certificates**. Organizations and their website domains push their public certificates to website visitors. CAs and certificate domain registrars create and distribute private and public certificates to clients that purchase certificates.

The certificate enrollment process is used by a host system to enroll with a PKI. To do so, CA certificates are retrieved in-band over a network, and the authentication is done out-of-band (OOB) using the telephone. The system enrolling with the PKI contacts a CA to request and obtain a digital identity certificate for itself and to get the CA’s self-signed certificate. The final stage verifies that the CA certificate was authentic and is performed using an out-of-band method such as the Plain Old Telephone System (POTS) to obtain the fingerprint of the valid CA identity certificate.

**Authentication no longer requires the presence of the CA server, and each user exchanges their certificates containing public keys.**

Certificates must sometimes be revoked. For example, a digital certificate can be revoked if key is compromised or if it is no longer needed.

Here are two of the most common methods of revocation:

**Certificate Revocation List (CRL)**: A list of revoked certificate serial numbers that have been invalidated because they expired. PKI entities regularly poll the CRL repository to receive the current CRL.
**Online Certificate Status Protocol (OCSP)**: An internet protocol used to query an OCSP server for the revocation status of an X.509 digital certificate. Revocation information is immediately pushed to an online database.

### PKI Applications

Where can PKI be used by an enterprise? The following provides a short list of common uses of PKIs:

* SSL/TLS certificate-based peer authentication
* Secure network traffic using IPsec VPNs
* HTTPS Web traffic
* Control access to the network using 802.1x authentication
* Secure email using the S/MIME protocol
* Secure instant messaging
* Approve and authorize applications with Code Signing
* Protect user data with the Encryption File System (EFS)
* Implement two-factor authentication with smart cards
* Securing USB storage devices

### Encrypted Network Transactions

A security analyst must be able to recognize and solve potential problems related to permitting PKI-related solutions on the enterprise network.

Consider how the increase of SSL/TLS traffic poses a major security risk to enterprises because the traffic is encrypted and cannot be intercepted and monitored by normal means. Users can introduce malware or leak confidential information over an SSL/TLS connection.

Threat actors can use SSL/TLS to introduce regulatory compliance violations, viruses, malware, data loss, and intrusion attempts in a network.

Other SSL/TLS-related issues may be associated with validating the certificate of a web server. When this occurs, web browsers will display a security warning. PKI-related issues that are associated with security warnings include:

**Validity date range**: The X.509v3 certificates specify “not before” and “not after” dates. If the current date is outside the range, the web browser displays a message. Expired certificates may simply be the result of administrator oversight, but they may also reflect more serious conditions.
**Signature validation error**: If a browser cannot validate the signature on the certificate, there is no assurance that the public key in the certificate is authentic. Signature validation will fail if the root certificate of the CA hierarchy is not available in the browser’s certificate store.

Some of these issues can be avoided due to the fact that the SSL/TLS protocols are extensible and modular. This is known as a cipher suite. The key components of the cipher suite are the Message Authentication Code Algorithm (MAC), the encryption algorithm, the key exchange algorithm, and the authentication algorithm. These can be changed without replacing the entire protocol. This is very helpful because the different algorithms continue to evolve. As cryptanalysis continues to reveal flaws in these algorithms, the cipher suite can be updated to patch these flaws. When the protocol versions within the cipher suite change, the version number of SSL/TLS changes as well.

### Encryption and Security Monitoring

Network monitoring becomes more challenging when packets are encrypted. However, security analysts must be aware of those challenges and address them as best as possible. For instance, when site-to-site VPNs are used, the IPS should be positioned so it can monitor unencrypted traffic.

However, the increased use of HTTPS in the enterprise network introduces new challenges. Since HTTPS introduces end-to-end encrypted HTTP traffic (via TLS/SSL), it is not as easy to peek into user traffic.

Security analysts must know how to circumvent and solve these issues. Here is a list of some of the things that a security analyst could do:

* Configure rules to distinguish between SSL and non-SSL traffic, HTTPS and non-HTTPS SSL traffic.
* Enhance security through server certificate validation using CRLs and OCSP.
* Implement antimalware protection and URL filtering of HTTPS content.
* Deploy a Cisco SSL Appliance to decrypt SSL traffic and send it to intrusion prevention system (IPS) appliances to identify risks normally hidden by SSL.

**Cryptography is dynamic and always changing. A security analyst must maintain a good understanding of cryptographic algorithms and operations to be able to investigate cryptography-related security incidents.**

There are two main ways in which cryptography impacts security investigations. First, attacks can be directed to specifically target the encryption algorithms themselves. After the algorithm has been cracked and the attacker has obtained the keys, any encrypted data that has been captured can be decrypted by the attacker and read, thus exposing private data. Secondly, the security investigation is also affected because data can be hidden in plain sight by encrypting it. For example, command and control traffic that is encrypted with TLS/SSL most likely cannot be seen by a firewall. The command and control traffic between a command and control server and an infected computer in a secure network cannot be stopped if it cannot be seen and understood. The attacker would be able to continue using encrypted commands to infect more computers and possibly create a botnet. This type of traffic can be detected by decrypting the traffic and comparing it with known attack signatures, or by detecting anomalous TLS/SSL traffic. This is either very difficult and time consuming, or a hit-or-miss process.

## Cryptography Summary

Securing Communications

Organizations must provide support to secure data as it travels across links. There are four elements of secure communications: data integrity, origin authentication, data confidentiality, and data non-repudiation. Cryptography can be used almost anywhere that there is data communication. Hashes are used to verify and ensure data integrity. Hashing is based on a one-way mathematical function that is relatively easy to compute, but significantly harder to reverse. The cryptographic hashing function can also be used to verify integrity. A hash function takes a variable block of binary data, called the message, and produces a fixed-length, condensed representation, called the hash. There are four well-known hash functions: MD5 with 128-bit digest, SHA-1, SHA-2, and SHA-3. While hashing can be used to detect accidental changes, it cannot be used to guard against deliberate changes that are made by a threat actor. Hashing is vulnerable to man-in-the-middle attacks. To provide integrity and origin authentication, something more is required. To add authentication to integrity assurance, use a keyed-has message code (HMAC). HMAC uses an additional secret key as input to the hash function.

Data Confidentiality

There are two classes of encryption that are used to provide data confidentiality: asymmetric and symmetric. These two classes differ in how they use keys. Symmetric encryption algorithms, such as DES, 3 DES, and AES are based on the premise that each communicating party knows the pre-shared key. Data confidentiality can also be ensured using asymmetric algorithms, including Rivest, Shamir, and Aldeman (RSA) and PKI. Symmetric algorithms are commonly used with VPN traffic because they use less CPU resources than asymmetric encryption algorithms. Symmetric encryption algorithms are sometimes classified as either block cipher or stream ciphers. Asymmetric algorithms (public key algorithms) are designed so that the key that is used for encryption is different from the key used for encryption. Asymmetric algorithms use a public and private key. Examples of protocols that use asymmetric key algorithms included IKE, SSL, SSH, and PGP. Common examples of asymmetric encryption algorithms include DSS, DSA, RSA, EIGamal, and elliptic curve techniques. Asymmetric algorithms are used to provide confidentiality without pre-sharing a password. The process is summarized using this formula: Public key (Encrypt) + Private Key (Decrypt) = Confidentiality. The authentication objective of an asymmetric algorithm is initiated when the encryption process is started with the private key. The process can be summarized with this formula: Private Key (Encrypt) + Public Key (Decrypt) = Authentication. Combining the two asymmetric encryption processes provides message confidentiality, authentication, and integrity. Diffie-Helllman (DH) is an asymmetric mathematical equation algorithm that allows two computers to generate an identical shared secret key without having communicate before. Two examples of instances when DH is used are when data is exchanges using an IPsec VPN, and when SSH data is exchanged.

Public Key Cryptography

Digital signatures are a mathematical technique used to provide three basic security services: authenticity, integrity, and nonrepudiation. Properties of digital signature are that they are authentic, unalterable, not reusable, and non-repudiated. Digital signatures are commonly used in the following two situations: code signing and digital certificates. There are three Digital Signature Standard (DSS) algorithms that are used for generating and verifying digital signatures: Digital Signature Algorithm (DSA), Rivet-Shamir Adelman Algorithm (RSA) and Elliptical Curve Digital Signature Algorithm (ECDSA). Digitally signing code provides assurances about the software code: the code is authentic and is actually sourced by the publisher, the code has not been modified since it left the software publisher, and the publisher undeniably published the code. A digital certificate is equivalent to an electronic passport. It enables users, hosts, and organizations to securely exchanges information over the internet. Specifically, a digital certificate is used to authenticate and verify that a user who is sending a message is who they claim to be.

Authorities and the PKI Trust System

When establishing secure connection between two hosts, the hosts will exchange their public key information. There are trusted third parties on the internet that validate the authenticity of these public keys using digital certificates. The Public Key Infrastructure (PKI) consists of specifications, systems, and tools that are used to create, manage, distribute, use, store, and revoke digital certificates. PKI is needed to support large-scale distribution of public encryption keys. The PKI framework facilitates a highly scalable trust relationship. Many vendors provide CA servers as a managed service or as an end-user product. Some of these vendors include Symantec Group (VeriSign), Comodo, Go Daddy Group, GlobalSign, and DigiCert among others. The class number (0 thorough 5) is determined by how rigorous the procedure was that verified the identity of the holder when the certificate was issued, with five being the highest. PKIs can form different topologies of trust. The simplest is the single-root PKI topology. Interoperability between PKI and its supporting services is a concern because many CA vendors have proposed and implemented proprietary solution instead of waiting for standards to develop. To address the interoperability concern, the IETF published the Internet X>509 Public Key Infrastructure Certificate Policy and Certification Framework (RFC 2527).

Applications and Impacts of Cryptography

There are many common uses of PKIs including a few listed here: SSL/TLS certificate-based peer authentication, HTTPS Web traffic, secure instant message, and securing USB storage devices. A security analyst must be able to recognize and solve potential problems related to permitting PHI-related solutions on the enterprise network. For example, threat actors can use SSL/TSL to introduce regulatory compliance violations, viruses, malware, data loss, and intrusion attempts in the network. Other SSL/TSL related issues may be associated with validating the certificate of the web server. PKI-related issues that are associated with security warnings include validity date range and signature validation. Some of these issues can be avoided due to the fact that the SSL/TSL protocols are extensible and modular. This is known as the cipher suite. The key components of the cipher suite are the Message Authentication Code Algorithm (MAC), the encryption algorithm, the key exchange algorithm, and the authentication algorithm. Cryptography is dynamic and always changing. You must maintain a good understanding of algorithms and operations to be able to investigate cryptography-related security incidents. Encrypted communications can make network security data payloads unreadable by cybersecurity analysts. Encryption can be used to hide malware command and control traffic between infected hosts and the command and control servers. In addition, malware can be hidden by encryption and data can be encrypted during exfiltration, making it hard to detect.

## Module 21: Public Key Cryptography Quiz

1. Which statement describes the Software-Optimized Encryption Algorithm (SEAL)? Topic 21.2.0 - SEAL is a stream cipher that uses a 160-bit encryption key. It is a symmetric encryption algorithm that has a lower impact on the CPU resources compared to other software-based algorithms, such as software-based DES, 3DES, and AES. SEAL is a stream chipher

2. Which statement is a feature of HMAC? Topic 21.1.0 - A keyed-hash message authentication code (HMAC or KHMAC) is a type of message authentication code (MAC). HMACs use an additional secret key as input to the hash function, adding authentication to data integrity assurance. HMAC uses a secret key as input to the hash function, adding authentication to integrity assurance.

3. Which requirement of secure communications is ensured by the implementation of MD5 or SHA hash generating algorithms?​ Topic 21.1.0 - Integrity is ensured by implementing either MD5 or SHA hash generating algorithms. Many modern networks ensure authentication with protocols, such as HMAC. Data confidentiality is ensured through symmetric encryption algorithms, including DES, 3DES, and AES. Data confidentiality can also be ensured using asymmetric algorithms, including RSA and PKI.​ integrity

4. Which algorithm can ensure data confidentiality? Topic 21.1.0 - Data confidentiality is ensured through symmetric encryption algorithms, including DES, 3DES, and AES. AES

5. In which way does the use of HTTPS increase the security monitoring challenges within enterprise networks? Topic 21.5.0 - HTTPS enables end-to-end encrypted network communication, which adds further challenges for network administrators to monitor the content of packets to catch malicious attacks. HTTPS traffic enables end-to-end encryption.

6. Which protocol is an IETF standard that defines the PKI digital certificate format? Topic 21.4.0 - To address the interoperability of different PKI vendors, IETF published the Internet X.509 Public Key Infrastructure Certificate Policy and Certification Practices Framework (RFC 2527). The standard defines the format of a digital certificate. X.509

7. What are two symmetric encryption algorithms? (Choose two.)  Topic 21.2.0 - MD5, HMAC, and SHA are hashing algorithms. AES, 3DES

8. What is the purpose of code signing? Topic 21.3.0 - Code signing is used to verify the integrity of executable files downloaded from a vendor website. Code signing uses digital certificates to authenticate and verify the identity of a website. integrity of source .EXE files

9. Which statement describes the use of certificate classes in the PKI? Topic 21.4.0 - The higher the certificate number, the more trustworthy the certificate. Class 1 certificates are for individuals, with a focus on email verification. An enterprise can act as its own CA and implement PKI for internal use. In that situation, the vendor can issue certificates as needed for various purposes.​ A class 5 certificates is more trustworthy tha a class 4 certificate.

10. What role does an RA play in PKI? Topic 21.4.0 - A registration authority (RA) is a subordinate CA. It is certified by a root CA to issue certificates for specific uses. a subordinate CA

11. What technology supports asymmetric key encryption used in IPsec VPNs? IKE

12. What technology allows users to verify the identity of a website and to trust code that is downloaded from the Internet? Topic 21.3.0 - Digital signatures provide assurance of the authenticity and integrity of software codes. They provide the ability to trust code that is downloaded from the Internet. digital signature.

